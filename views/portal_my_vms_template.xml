<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <template id="portal_my_vms" name="My Virtual Machines">
    <t t-call="portal.portal_layout">
      <div class="container vm-list">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>My Virtual Machines</h2>
            <a href="/shop" class="btn btn-primary" role="button">Order New VM</a>
        </div>
        
        <t t-if="vms">
          <div class="table-responsive">
            <table class="table table-hover">
                <tbody>
                    <t t-foreach="vms" t-as="vm">
                        <tr t-att-data-vm-id="vm.id">
                            <td>
                                <strong><t t-esc="vm.name"/></strong><br/>
                                <small class="text-muted"><t t-esc="vm.hypervisor_vm_ref"/></small>
                            </td>
                            <td class="text-center align-middle vm-status-cell">
                                <span t-if="vm.state == 'active'" class="badge badge-success">Active</span>
                                <span t-if="vm.state == 'stopped'" class="badge badge-secondary">Stopped</span>
                                <span t-if="vm.state == 'suspended'" class="badge badge-warning">Suspended</span>
                                <span t-if="vm.state == 'pending'" class="badge badge-info">Pending</span>
                                <span t-if="vm.state in ['terminated', 'archived']" class="badge badge-dark">Archived</span>
                            </td>
                            <td class="text-center align-middle">
                                <t t-esc="vm.end_date" t-options='{"widget": "date"}'/>
                            </td>
                            <td class="text-right vm-actions-cell align-middle">
                                <i class="fa fa-spinner fa-spin d-none mr-2"/>
                                
                                <div class="btn-group" role="group">
                                    <button t-if="vm.state in ['stopped', 'suspended']" t-att-data-vmid="vm.id" class="btn btn-sm btn-success start-vm" title="Start VM">
                                        <i class="fa fa-play"/>
                                    </button>
                                    <button t-if="vm.state == 'active'" t-att-data-vmid="vm.id" class="btn btn-sm btn-warning stop-vm" title="Stop VM">
                                        <i class="fa fa-stop"/>
                                    </button>
                                    <button t-if="vm.state == 'active'" t-att-data-vmid="vm.id" class="btn btn-sm btn-info reboot-vm" title="Reboot VM">
                                        <i class="fa fa-refresh"/>
                                    </button>
                                </div>

                                <div class="btn-group ml-2" role="group">
                                    <a t-att-href="'/my/vm/%s/snapshots' % vm.id" class="btn btn-sm btn-secondary" title="Manage Snapshots" role="button">
                                        <i class="fa fa-camera-retro"/>
                                    </a>
                                    <a t-if="vm.hypervisor_vm_ref" t-att-href="'/my/vms/console/%s' % vm.id" class="btn btn-sm btn-dark" target="_blank" title="Open Console" role="button">
                                        <i class="fa fa-terminal"/>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    </t>
                </tbody>
            </table>
          </div>
        </t>
        <t t-else="">
            <div class="alert alert-info" role="alert">
              You do not have any virtual machines yet.
            </div>
        </t>
        </div>
    </t>
  </template>
</odoo>